<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Banking Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/gh/ethereum/web3.js@1.5.2/dist/web3.min.js"></script>
</head>
<body class="bg-gray-100">

  <!-- Navbar -->
  <nav class="bg-blue-600 p-4 shadow-md">
    <div class="container mx-auto flex justify-between items-center">
      <div class="text-white text-2xl font-bold">Banking Dashboard</div>
      <div class="text-white">Welcome, User</div>
    </div>
  </nav>

  <!-- Main Content -->
  <div class="container mx-auto mt-10">
    <!-- Card with balance -->
    <div class="bg-white p-6 rounded-lg shadow-md flex justify-between items-center">
      <div>
        <h2 class="text-2xl font-semibold text-gray-700">Current Balance</h2>
        <p id="balance" class="text-4xl font-bold text-blue-600">$1</p>
      </div>
      <div>
        <button onclick="getBalance()" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition">Refresh Balance</button>
      </div>
    </div>

    <!-- Buttons for deposit/withdraw -->
    <div class="grid grid-cols-2 gap-6 mt-8">
      <!-- Deposit -->
      <div class="bg-white p-6 rounded-lg shadow-md flex flex-col items-center">
        <h3 class="text-xl font-semibold text-gray-700 mb-4">Deposit Funds</h3>
        <input type="number" id="depositAmount" placeholder="Amount" class="w-full p-2 mb-4 border border-gray-300 rounded">
        <button onclick="deposit()" class="bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 transition">Deposit</button>
      </div>

      <!-- Withdraw -->
      <div class="bg-white p-6 rounded-lg shadow-md flex flex-col items-center">
        <h3 class="text-xl font-semibold text-gray-700 mb-4">Withdraw Funds</h3>
        <input type="number" id="withdrawAmount" placeholder="Amount" class="w-full p-2 mb-4 border border-gray-300 rounded">
        <button onclick="withdraw()" class="bg-red-600 text-white px-4 py-2 rounded-md hover:bg-red-700 transition">Withdraw</button>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer class="bg-gray-800 p-4 mt-10 text-white text-center">
    &copy; 2024 Banking Dashboard. All rights reserved.
  </footer>

  <script>
    let web3;
    let bankContract;
    let userAccount;

    const contractAddress = "0x0fC5025C764cE34df352757e82f7B5c4Df39A836";  
    const contractABI = [
    [
	{
		"inputs": [
			{
				"internalType": "int256",
				"name": "amt",
				"type": "int256"
			}
		],
		"name": "deposit",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"stateMutability": "nonpayable",
		"type": "constructor"
	},
	{
		"inputs": [
			{
				"internalType": "int256",
				"name": "amt",
				"type": "int256"
			}
		],
		"name": "withdraw",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "getBalance",
		"outputs": [
			{
				"internalType": "int256",
				"name": "",
				"type": "int256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	}
]
    ];

    // Initialize Web3 connection
    window.addEventListener('load', async () => {
      if (typeof window.ethereum !== 'undefined') {
        web3 = new Web3(window.ethereum);
        try {
          await ethereum.request({ method: 'eth_requestAccounts' });
          userAccount = (await web3.eth.getAccounts())[0];  // Get user's account
          bankContract = new web3.eth.Contract(contractABI, contractAddress);  // Connect to your Bank contract
        } catch (error) {
          console.error("User denied account access", error);
        }
      } else {
        console.error("Non-Ethereum browser detected. Please install MetaMask.");
      }
    });

    // Function to get balance from the smart contract
    async function getBalance() {
      try {
        const balance = await bankContract.methods.getBalance().call({ from: userAccount });
        document.getElementById('balance').innerText = "$" + balance;
      } catch (error) {
        console.error(error);
      }
    }

    // Function to deposit amount
    async function deposit() {
      const amount = document.getElementById('depositAmount').value;
      try {
        await bankContract.methods.deposit(parseInt(amount)).send({ from: userAccount });
        alert(`Deposited ${amount} successfully!`);
        getBalance();  // Update balance after deposit
      } catch (error) {
        console.error(error);
      }
    }

    // Function to withdraw amount
    async function withdraw() {
      const amount = document.getElementById('withdrawAmount').value;
      try {
        await bankContract.methods.withdraw(parseInt(amount)).send({ from: userAccount });
        alert(`Withdrew ${amount} successfully!`);
        getBalance();  // Update balance after withdrawal
      } catch (error) {
        console.error(error);
      }
    }
  </script>
</body>
</html>
